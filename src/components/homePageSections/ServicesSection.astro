---
import ServiceCard from "@/components/cards/ServiceCard.astro";
import Heading from "@/components/common/Heading.astro";
import NeuralLine from "@/components/background_animation/NeuralLine.astro";
import { Button } from "@/components/interactive/ui/button";
import { client } from "@/lib/sanity";
import { getIcon } from "@/utils/functions";
import type { IService } from "@/utils/types";

// Fetch top 3 services from Sanity
let services: IService[] = [];
try {
  services = await client.fetch<IService[]>(
    `*[_type == "service"] | order(order asc)[0...3] {
    "id": slug.current,
    title,
    description,
    "iconName": icon,
    features
  }`,
  );
} catch (err) {
  console.error("Error fetching services:", err);
}
---

<!-- Services Section -->
<section id="services" class="py-10 sm:py-20 relative">
  <div class="container mx-auto flex flex-col gap-8 sm:gap-16 relative">
    <!-- Header -->
    <Heading
      section="Our Services"
      title="Comprehensive"
      highlights="AI Solutions"
      subtitle="From machine learning to automation, we offer a full spectrum of AI services designed to transform your business operations and drive sustainable growth."
    />
    <div class="flex flex-col gap-8 sm:gap-12">
      <!-- Services Grid -->
      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-5 sm:gap-8">
        {
          services.length > 0 ? (
            services.map((service, index: number) => (
              <ServiceCard
                id={service.id}
                icon={getIcon(service.iconName)}
                title={service.title}
                description={service.description}
                features={service.features || []}
                animationDelay={300 + index * 100}
              />
            ))
          ) : (
            <div class="col-span-full text-center py-20 text-muted-foreground">
              <p>No services found. Check back later!</p>
            </div>
          )
        }
      </div>
      <div class="text-center" data-aos="fade-up" data-aos-delay="600">
        <a href="/services">
          <Button variant="hero" size="lg" className="w-fit mx-auto"
            >View More Services</Button
          >
        </a>
      </div>
    </div>
  </div>
  <NeuralLine />
</section>
<!-- End Services Section -->
